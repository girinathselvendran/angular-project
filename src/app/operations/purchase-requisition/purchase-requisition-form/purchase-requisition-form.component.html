
<div class="panel-body">
  <div class="widget-body fuelux">
    <div class="container-fluid">
      <div class="row">
        <form
          [formGroup]="editSavePRForm"
          autocomplete="off"
          class="container-new-ui"
        >
          <div class="row">
            <!-- Depot -->
            <div class="col-lg-2 col-md-2 col-sm-2">
              <label for="depot" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.depot'"
                ></span>
                <span class="redIcon"> *</span>
              </label>

              <ng-select
                [items]="associatedDepots"
                [searchFn]="dropdownDepotSearchFn"
                [selectOnTab]="true"
                (input)="checkNgSelectValue($event, 'depot')"
                bindLabel="depotCode"
                formControlName="depot"
                notFoundText="Not found"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.depot' | translate
                }}"
                [ngClass]="{
                  redBorder:
                    (submitted &&
                      this.editSavePRFormController['depot'].errors) ||
                    (this.editSavePRFormController['depot'].errors &&
                      (this.editSavePRFormController['depot'].dirty ||
                        this.editSavePRFormController['depot'].touched))
                }"
              >
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-index="index"
                  let-search="searchTerm"
                >
                  <div title="{{ item?.depotCode }} - {{ item?.depotName }}">
                    <small
                      ><b>{{ item?.depotCode }}</b></small
                    ><br />
                    <span class="dropDownDescription">{{
                      item?.depotName
                    }}</span>
                  </div>
                </ng-template>
              </ng-select>

              <div
                class="help-block red"
                *ngIf="
                  (submitted &&
                    this.editSavePRFormController['depot'].errors) ||
                  (this.editSavePRFormController['depot'].errors &&
                    (this.editSavePRFormController['depot'].dirty ||
                      this.editSavePRFormController['depot'].touched))
                "
              >
                <p
                  *ngIf="
                    this.editSavePRFormController['depot'].errors['invalid']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.depot.invalid'
                    "
                  ></span>
                </p>
                <p
                  *ngIf="
                    this.editSavePRFormController['depot'].errors['required']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.depot.required'
                    "
                  ></span>
                </p>
              </div>
            </div>

            <!-- Part Type -->
            <div class="col-lg-2 col-md-2 col-sm-2">
              <label for="partType" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.partType'"
                ></span>
                <span class="redIcon"> *</span>
              </label>

              <ng-select
                [items]="partTypeDDList"
                [searchFn]="dropdownSearchFnPartType"
                [selectOnTab]="true"
                (input)="checkNgSelectValue($event, 'partType')"
                bindLabel="code"
                formControlName="partType"
                notFoundText="Not found"
                (change)="onPartTypeSelected($event); combinationCheck()"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.partType'
                    | translate
                }}"
                [ngClass]="{
                  redBorder:
                    (submitted &&
                      this.editSavePRFormController['partType'].errors) ||
                    (this.editSavePRFormController['partType'].errors &&
                      (this.editSavePRFormController['partType'].dirty ||
                        this.editSavePRFormController['partType'].touched))
                }"
              >
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-index="index"
                  let-search="searchTerm"
                >
                  <div
                    class="card-body"
                    title="{{ item?.code }} - {{ item.description }}"
                  >
                    <div>
                      <small
                        ><b>{{ item?.code }}</b></small
                      ><br />
                      <span class="dropDownDescription">{{
                        item?.description
                      }}</span>
                    </div>
                  </div>
                </ng-template>
              </ng-select>

              <div
                class="help-block red"
                *ngIf="
                  (submitted &&
                    this.editSavePRFormController['partType'].errors) ||
                  (this.editSavePRFormController['partType'].errors &&
                    (this.editSavePRFormController['partType'].dirty ||
                      this.editSavePRFormController['partType'].touched))
                "
              >
                <p
                  *ngIf="
                    this.editSavePRFormController['partType'].errors['invalid']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.partType.invalid'
                    "
                  ></span>
                </p>
                <p
                  *ngIf="
                    this.editSavePRFormController['partType'].errors['required']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.partType.required'
                    "
                  ></span>
                </p>
              </div>
            </div>
            <!-- Part Code -->
            <div class="col-lg-2 col-md-2 col-sm-2">
              <label for="partCode" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.partCode'"
                ></span>
                <span class="redIcon"> *</span>
              </label>

              <ng-select
                [items]="partCodeDDList"
                [searchFn]="dropdownSearchFnPartCode"
                [selectOnTab]="true"
                (input)="checkNgSelectValue($event, 'partCode')"
                bindLabel="partCode"
                formControlName="partCode"
                notFoundText="Record not found"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.partCode'
                    | translate
                }}"
                (change)="onPartCodeSelected($event); combinationCheck()"
                [ngClass]="{
                  redBorder:
                    (submitted &&
                      this.editSavePRFormController['partCode'].errors) ||
                    (this.editSavePRFormController['partCode'].errors &&
                      (this.editSavePRFormController['partCode'].dirty ||
                        this.editSavePRFormController['partCode'].touched))
                }"
              >
                <ng-template
                  ng-option-tmp
                  let-item="item"
                  let-index="index"
                  let-search="searchTerm"
                >
                  <div
                    class="card-body"
                    title="{{ item?.partCode }} - {{ item.partName }}"
                  >
                    <div>
                      <small
                        ><b>{{ item?.partCode }}</b></small
                      ><br />
                      <span class="dropDownDescription">{{
                        item?.partName
                      }}</span>
                    </div>
                  </div>
                </ng-template>
              </ng-select>

              <div
                class="help-block red"
                *ngIf="
                  (submitted &&
                    this.editSavePRFormController['partCode'].errors) ||
                  (this.editSavePRFormController['partCode'].errors &&
                    (this.editSavePRFormController['partCode'].dirty ||
                      this.editSavePRFormController['partCode'].touched))
                "
              >
                <p
                  *ngIf="
                    this.editSavePRFormController['partCode'].errors['invalid']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.partCode.invalid'
                    "
                  ></span>
                </p>
                <p
                  *ngIf="
                    this.editSavePRFormController['partCode'].errors['required']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.partCode.required'
                    "
                  ></span>
                </p>
              </div>
            </div>
            <!-- Part Name -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="partName" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.partName'"
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="partName"
                formControlName="partName"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.partName'
                    | translate
                }}"
              />
            </div>

            <!-- Part Category -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="partCategory" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.partCategory'
                  "
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="partCategory"
                formControlName="partCategory"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.partCategory'
                    | translate
                }}"
              />
            </div>

            <!-- Available Stock -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="availableStock" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.availableStock'
                  "
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="availableStock"
                formControlName="availableStock"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.availableStock'
                    | translate
                }}"
              />
            </div>

            <!-- Stock UOM -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="stockUOM" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.stockUOM'"
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="stockUOM"
                formControlName="stockUOM"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.stockUOM'
                    | translate
                }}"
              />
            </div>

            <!-- Requistion Quantity -->
            <div
              class="form-group col-lg-2 col-md-2 col-sm-3"
              [ngClass]="{
                'has-error':
                  (submitted &&
                    this.editSavePRFormController['requisitionQuantity']
                      .errors) ||
                  (this.editSavePRFormController['requisitionQuantity']
                    .errors &&
                    (this.editSavePRFormController['requisitionQuantity']
                      .dirty ||
                      this.editSavePRFormController['requisitionQuantity']
                        .touched))
              }"
            >
              <label for="requisitionQuantity" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.requisitionQuantity'
                  "
                ></span>
                <i class="red"> *</i>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control amountInput new-form-control-input"
                id="requisitionQuantity"
                formControlName="requisitionQuantity"
                maxlength="15"
                [scale]="2"
                numericType="decimal"
                numeric
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.requisitionQuantity'
                    | translate
                }}"
                (input)="handleAmountCalculation('requisitionQuantity')"
              />

              <div
                class="help-block red"
                *ngIf="
                  (submitted &&
                    editSavePRFormController['requisitionQuantity'].errors) ||
                  (editSavePRFormController['requisitionQuantity'].errors &&
                    (editSavePRFormController['requisitionQuantity'].dirty ||
                      editSavePRFormController['requisitionQuantity'].touched))
                "
              >
                <p
                  *ngIf="
                    editSavePRFormController['requisitionQuantity'].errors[
                      'required'
                    ]
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requisitionQuantity.required'
                    "
                  ></span>
                </p>
                <div
                  *ngIf="
                    editSavePRFormController['requisitionQuantity'].errors[
                      'min'
                    ]
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requisitionQuantity.limit'
                    "
                  ></span>
                </div>
                <div
                  *ngIf="
                    editSavePRFormController['requisitionQuantity'].errors[
                      'max'
                    ]
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requisitionQuantity.limit'
                    "
                  ></span>
                </div>
              </div>
            </div>

            <!-- partRate -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="partRate" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.partRate'"
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control amountInput new-form-control-input"
                id="partRate"
                formControlName="partRate"
                [scale]="2"
                numericType="decimal"
                numeric
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.partRate'
                    | translate
                }}"
                (input)="handleAmountCalculation('partRate')"
              />
            </div>

            <!-- estimatedCost -->
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="estimatedCost" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.estimatedCost'
                  "
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control amountInput new-form-control-input"
                id="estimatedCost"
                formControlName="estimatedCost"
                maxlength="100"
                [scale]="2"
                numericType="decimal"
                numeric
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.estimatedCost'
                    | translate
                }}"
              />
            </div>

            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="requiredDate" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.requiredDate'
                  "
                ></span>
                <i class="red"> *</i>
              </label>
              <div class="input-group input-group-md">
                <input
                  type="text"
                  class="form-control uppercase"
                  bsDatepicker
                  (keydown.arrowdown)="requiredDate.click()"
                  formControlName="requiredDate"
                  #requiredDate
                  [bsConfig]="{
                    dateInputFormat: 'DD-MMM-YYYY',
                    containerClass: 'theme-dark-blue',
                    adaptivePosition: true
                  }"
                  [ngClass]="{
                    redBorderCalender:
                      (submitted &&
                        editSavePRFormController['requiredDate'].errors) ||
                      (editSavePRFormController['requiredDate'].errors &&
                        (editSavePRFormController['requiredDate'].dirty ||
                          editSavePRFormController['requiredDate'].touched))
                  }"
                  (ngModelChange)="validateRequiredDate('requiredDate', $event)"
                />

                <span class="input-group-btn">
                  <button
                    class="btn custom-button"
                    type="button"
                    (click)="requiredDate.click()"
                    tabindex="-1"
                  >
                    <app-svg-calender-icon></app-svg-calender-icon>
                  </button>
                </span>
              </div>
              <div
                class="help-block red"
                *ngIf="
                  (submitted &&
                    editSavePRFormController['requiredDate'].errors) ||
                  (editSavePRFormController['requiredDate'].errors &&
                    (editSavePRFormController['requiredDate'].dirty ||
                      editSavePRFormController['requiredDate'].touched))
                "
              >
                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['invalid']"
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requiredDate.invalid'
                    "
                  ></span>
                </div>
                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['customError']"
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requiredDateGreaterThanCurrent'
                    "
                  ></span>
                  {{ currentDate | date : "dd-MMM-yyyy" | uppercase }}
                </div>
                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['bsDate']"
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requiredDate.invalid'
                    "
                  ></span>
                </div>
                <div
                  *ngIf="
                    editSavePRFormController['requiredDate'].errors['required']
                  "
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requiredDate.required'
                    "
                  ></span>
                </div>
                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['invalidToDate']"
                >
                  <span
                    [translate]="
                      'gateMovesReport.error.endPeriodGreaterThanToDate'
                    "
                  >
                  </span>
                  {{
                    editSavePRFormController["requiredDate"].value
                      | date : "dd-MMM-yyyy"
                      | uppercase
                  }}
                </div>

                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['inValidCurrentDate']"
                >
                  <span
                    [translate]="
                      'gateMovesReport.error.endPeriodSmallerThanCurrent'
                    "
                  ></span>
                  {{ currentDate | date : "dd-MMM-yyyy" | uppercase }}
                </div>
                <div
                  *ngIf="editSavePRFormController['requiredDate'].errors?.['inValidDateString']"
                >
                  <span
                    [translate]="
                      'operations.purchaseRequisition.errors.requiredDate.invalid'
                    "
                  ></span>
                </div>
              </div>
            </div>

            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="purchaseSpecification" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.purchaseSpecification'
                  "
                ></span>
              </label>
              <br />
              <p class="margin-left-10 font-20">
                <i
                  class="far fa-eye clickable"
                  (click)="handleOpenPurchaseSpecification()"
                ></i>
              </p>
            </div>

            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="createdBy" class="labelText">
                <span
                  [translate]="'operations.purchaseRequisition.label.createdBy'"
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="createdBy"
                formControlName="createdBy"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.createdBy'
                    | translate
                }}"
              />
            </div>
            <div class="form-group col-lg-2 col-md-2 col-sm-3">
              <label for="createdDate" class="labelText">
                <span
                  [translate]="
                    'operations.purchaseRequisition.label.createdDate'
                  "
                ></span>
              </label>
              <input
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="createdDate"
                formControlName="createdDate"
                maxlength="100"
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.createdDate'
                    | translate
                }}"
              />
            </div>

            <div class="form-group col-lg-4 col-md-4 col-sm-4">
              <label for="remarks" class="labelText"
                ><span [translate]="'Remarks'"></span>
              </label>
              <textarea
                placeholder="{{
                  'operations.purchaseRequisition.placeholder.remarks'
                    | translate
                }}"
                type="text"
                trim="blur"
                class="form-control new-form-control-input"
                id="remarks"
                formControlName="remarks"
                maxlength="500"
                spaceatfirst
              ></textarea>
            </div>
          </div>
          <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12">
              <label>
                <b>Total Estimate Cost: {{ totalEstimatedCode }}</b>
              </label>
            </div>
            <!-- {{purchaseRequisitionPartsList|json}} -->
            <div class="col-lg-12 col-md-12 col-sm-12">
              <app-shared-table-new
                #sharedTableNew
                [headerColumnList]="prPartListColumnList"
                [tableInitialData]="purchaseRequisitionPartsList"
                [filter]="true"
                [excelIcon]="true"
                [refreshIcon]="true"
                [tableTitle]="'Purchase Requisition Part List'"
                (sendTableRowData)="receiveTablePartList($event)"
                (refreshTableData)="refreshPrPartList($event)"
                (getTableDataService)="refreshPrPartList($event)"
                [deleteIcon]="true"
                (handleDeleteRowData)="deleteRowDataPrPart($event)"
                [excelFileName]="'Purchase Requisition Part List'"
              ></app-shared-table-new>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
